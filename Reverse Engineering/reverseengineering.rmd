
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Group: Adam, Sam, Will

## Introduction 

In this notebook, we are reverse engineering the story, "Comic Books are still Made by Men, for Men and About Men" (https://fivethirtyeight.com/features/women-in-comic-books/)

## Load libraries

Loading required libraries for this analysis.

```{r}
options(scipen=999)
library(tidyverse)
library(janitor)
library(lubridate)

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}
#Load DC Comics Data
dc_data <- read_csv("dc-wikia-data.csv")

#Load Marvel Comics Data
marvel_data <- read_csv("marvel-wikia-data.csv")

```

## Sentences to Engineer
In this notebook, we are reverse engineering five sentences from the story.

Finding #1:

"The Wikias also count up the number of appearances of each character in the comic books they have in their databases. I was able to pull appearance counts for 6,541 of the DC characters and 15,280 Marvel characters. Since I’m also interested in how female representation has changed over time, I pulled the month and year of the first issue each character appeared in. I got first-appearance data for 6,827 DC characters and 15,561 Marvel characters."

Analysis: After filtering the data to remove na values from both "APPEARANCES" and "FIRST APPEARANCE," we found that there were 6,827 first appearances of DC characters and 15,561 appearances of Marvel characters. These findings exactly replicate the findings of the original article. 

```{r}
marvel_appearances <- marvel_data |> filter(!is.na(APPEARANCES)) |> nrow()
dc_appearances <- dc_data |> filter(!is.na(APPEARANCES)) |> nrow()
 
# Count number of characters with first appearance data
marvel_first_appear <- marvel_data |> filter(!is.na(`FIRST APPEARANCE`)) |> nrow()
dc_first_appear <- dc_data |> filter(!is.na(`FIRST APPEARANCE`)) |> nrow()

#Display number of characters with first appearance data
marvel_first_appear

dc_first_appear

```

Finding #2:

"Women were substantially underrepresented among characters with at least one appearance. Among the characters for which we have gender data, females made up only 29.3 percent of the DC character list and 24.7 percent of the Marvel roster."

Analysis: After removing na values, we completed a simple calculation to find that the DC percentage was 24.749, and the Marvel percentage was 29.25159 After rounding, these findings exactly replicate the findings of the original article. 

```{r}
# Filter to characters with at least one appearance and known gender
marvel_gender <- marvel_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX)) 

dc_gender <- dc_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX)) 

# Calculate percent female
marvel_gender |>
  summarize(marvel_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()

dc_gender |>
  summarize(dc_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()
```

Finding #3:

"The same trend bears out when we look at characters with higher appearance counts. When we zero in on the 2,415 DC and 3,342 Marvel characters with gender data who appear at least 10 times — the set of characters that probably gives the most consistent view of what we see on the page — female characters make up only 30.9 percent of the DC universe and 30.6 percent of the Marvel universe."

Analysis: Similar to the last finding, we removed na values and created a new dataset for characters with more than or equal to 10 appearances, then replicated the same calculations to find that the DC percentage was 30.93043 and the Marvel percentage was 30.62843. After rounding, these findings exactly replicate the findings of the original article. 

```{r}
# Filter to characters with at least 10 appearances and known gender
marvel_10 <- marvel_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX), APPEARANCES >= 10)

dc_10 <- dc_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX), APPEARANCES >= 10)

# Calculate percent female among those
marvel_10 |>
  summarize(marvel_10_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()

dc_10 |>
  summarize(dc_10_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()

```

Finding #4:

"When we focus on only the most frequently appearing characters in each universe — the stars of the show — the data changes. Of characters with gender data and 100 or more appearances (294 DC characters and 414 Marvel characters), only 29.0 percent of DC’s are female, and a similar 31.1 percent of the Marvel crowd is."

Analysis: This method is virtually the same as the previous one with appearances filtered to 100 versus just 10. The significance of the distinct groups is that this represents characters that were relatively successful and popular. Rounded to the tenth, the findings produced here match those of the article. 

```{r}
# Filter to characters with at least 100 appearances and known gender
marvel_100 <- marvel_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX), APPEARANCES >= 100)

dc_100 <- dc_data |>
  filter(!is.na(APPEARANCES), !is.na(SEX), APPEARANCES >= 100)

# Calculate percent female among those
marvel_100 |>
  summarize(marvel_100_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()

dc_100 |>
  summarize(dc_100_percent_female = mean(SEX == "Female Characters") * 100) |>
  arrange()

```

Finding #5:

"In both DC and Marvel, women were of neutral allegiance at a higher rate than men. Men were also more likely to be bad in each universe — in fact, bad-aligned men alone outnumbered all women combined. In other words, there’s something of a paucity of female villains.”

Analysis: We're creating new datasets and filtering na values of our relevant fields, SEX and ALIGN. For each universe, we summarised counts for both of those fields, and then grouped by only SEX to create new fields that show us the proportion of each gender that is good bad or neutral. The findings above can all be observed in the results below.  

```{r}
#Filter to rows with values for alignment and sex, get totals for each combination
marvel_alignment <- marvel_data |>
  filter(!is.na(ALIGN), !is.na(SEX)) |>
  group_by(SEX, ALIGN) |>
  summarise(count = n()) |>
  group_by(SEX) |>
  mutate(
    total_gender = sum(count),
    percent_gender = count / total_gender * 100
  )

dc_alignment <- dc_data |>
  filter(!is.na(ALIGN), !is.na(SEX)) |>
  group_by(SEX, ALIGN) |>
  summarise(count = n()) |>
  group_by(SEX) |>
  mutate(
    total_gender = sum(count),
    percent_gender = count / total_gender * 100
  )

#Return tables
marvel_alignment

dc_alignment

```


